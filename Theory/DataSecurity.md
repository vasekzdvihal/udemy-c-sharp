# Data Security

## Basics of Assemblies

- Assemblies are the basics unit of deployment in .NET
- An assembly is a container for Windows Portable Executable (PE)
- We know PE's by their file extensions
    - .exe files are application executables
    - .dll files are reusable library files
- An assembly contains up to four categories of info

1. Assembly manifest
    - The only mandatory item in an assembly
    - Describes the assembly to the managed hosting environment
    - Serves as a directory to the contents of the assembly
    - Makes the assembly self-describing
2. Application manifest
    - Provides info for the operating system
    - Deployment instructions and whether administrative elevation is required
3. Compiled Types
    - Compiled IL code of types
4. Resources
    - All other data as needed

## GAC Basics

- The Global Assembly Cache (GAC) is a central repository for .NET assemblies
    - Assemblies that are shared by several apps on the computer should be stored in the GAC
- Assemblies must be 'strongly-named' to be placed in the GAC
    - Generated by using the private key that corresponds to the public key distributed with the assembly itself
    - Strong-naming an assembly creates a unique identity for the assembly... do not rely on strong-name for security
- There are two ways to place an assembly in the GAC
    - Use an installer that is designed to work with the GAC
    - Use the Global Assembly Cache tool (Gacutil.exe)
- The default location for the GAC has been changed starting with the .NET Framework 4.0
    - Prior to 4.0, it was in %windir%\assembly
    - 4.0 and later, it is in %windir%\Microsoft.NET\assembly
- There are scenarios where you explicitly do not want to install an assembly into the GAC
    - XCOPY or ClickOnly deployment cannot be used because administrative action are required to install
    - Updating OAC assemblies require administrative privileges
    - Testing can become more difficult
    - Versioning and side-by-side execution becomes more complex

## Encrypting user files

- The .NET Framework makes encrypting files easy
- When working with files, the FIle object provides two methods...
    - Encrypt()
    - Decrypt()
- These methods perform all encryption and decryption activities in the background
    - Some functionality as checkboxes on file properties in explorer
    - Some limitation/concerns
    - Encryption is based on the user's password

``` csharp
      using System;
      using System.IO;
      namespace Encrypting_Files {
        class Program {
          static void Main(string[] args) {
            ReadFile();
            Console.WriteLine("Press enter to encrypt file...");
            Console.ReadLine();
            EncryptFile(@ "C:\MLFiles\ml.txt");
            Console.WriteLine("Press enter to decrypt file...");
            Console.ReadLine();
            DecryptFile(@ "C:\MLFiles\ml.txt");
          }

          public static void ReadFile() {
            int counter = 0;
            string line;
            // Read the file and display it line by line
            System.IO.StreamReader file = new StreamReader(@ "C:\MLFiles\ml.txt");
            while ((line = file.ReadLine()) != null) {
              Console.WriteLine(line);
            }
            counter++;
            file.Close();
          }

          public static void EncryptFile(string x) {
            File.Encrypt(x);
          }

          public static void DecryptFile(string x) {
            File.Decrypt(x);
          }
        }
      }
```

## Hashing

- What is hashing?
    - A one-way enryption technique that produces a fixed lenght 'fingerprint' of data
    - The hash cannot be reversed
- What is hashing useful?
    - Storing and comparing data
    - Passwords are excellent candidates for hashing
    - If two hashes match, the same value used to create both hashes
- What is salt?
    - Salt is a random string that is added to a value before is hashed
    - Makes hashed values much more difficult to crack

``` csharp
    using System;
    using System.Security.Cryptography;
    using System.Text;
    namespace Hashinh_Data {
      class Program {
        static void Main(string[] args) {
          Console.WriteLine("Enter a password to be hashed...");
          string pw = Console.ReadLine();
          Console.WriteLine();
          HashData hd = new HashData();
          Console.WriteLine("The hash value for " + pw + " is: ");
          string pwh = hd.CreateHash(pw);
          Console.WriteLine(pwh);
          Console.WriteLine();
          Console.WriteLine();
          Console.WriteLine("When the user logs in later, we'll get a password");
          Console.WriteLine("and compare it to the previous hash...");
          Console.WriteLine("Enter original password: ");
          string pw2 = Console.ReadLine();
          string pwh2 = hd.CreateHash(pw2);
          Console.WriteLine();
          Console.WriteLine("First hash: " + pwh);
          Console.WriteLine("Second hash: " + pwh2);
          if (pwh == pwh2) {
            Console.WriteLine("Files match.");
          } else {
            Console.WriteLine("No match");
          }
        }
      }

      public class HashData {
        public string CreateHash(string input) {
          HashAlgorithm sha = SHA256.Create();
          byte[] hashData = sha.ComputeHash(Encoding.Default.GetBytes(input));
          return Convert.ToBase64String(hashData);
        }
      }
    }
```